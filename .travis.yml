language: java

before_cache:
- rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
- rm -fr $HOME/.gradle/caches/*/plugin-resolution/

cache:
  directories:
  - $HOME/.gradle/caches/
  - $HOME/.gradle/wrapper/

deploy:
  provider: pages
  skip_cleanup: true
  github_token: $GITHUB_TOKEN
  keep_history: true
  on:
    branch: protect-gh-pages
  local_dir: docs
  target_branch: gh-pages

jobs:
  include:
    - stage: test
      script:
        - ./gradlew check
    - stage: docs
      if: branch = protect-gh-pages
      script:
        - ./gradlew dokka
